{# keyword_detail.html with breadcrumb navigation and optimized layout #}
{% extends "base.html" %}

{% block head %}
<style>
/* Custom scrollbar styling for Related Links */
.related-links-container::-webkit-scrollbar {
  width: 10px;
}

.related-links-container::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 5px;
}

.related-links-container::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 5px;
}

.related-links-container::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* Custom scrollbar styling for Extracted Text */
.bg-background::-webkit-scrollbar {
  width: 10px;
}

.bg-background::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 5px;
}

.bg-background::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 5px;
}

.bg-background::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* Ensure smooth scrolling */
.related-links-container {
  scroll-behavior: smooth;
}

/* Flexible height containers */
.flex-fill {
  flex: 1 1 auto;
}

/* Main card minimum height */
.result-card {
  min-height: 80vh;
}

/* Empty state styling */
.related-links-empty {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 600px;
  color: #6c757d;
  font-size: 0.9rem;
}

/* Remove bottom border from last item to maintain clean look */
.related-links-container .list-group-item:last-child {
  border-bottom: none !important;
}

/* Compact styling for related links */
.related-links-container .list-group-item {
  padding: 0.5rem 0.75rem;
  font-size: 0.9rem;
  word-break: break-all;
}

.related-links-container .list-group-item:hover {
  background-color: #e9ecef;
}
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
 

  <h2 class="text-center mb-4">Keyword Analysis Results</h2>

  <div class="card result-card">
    <!-- Header with Back Button -->
    <div class="card-header bg-dark text-white">
      <div class="d-flex align-items-center justify-content-between w-100">
        <div class="d-flex align-items-center flex-grow-1">
          <i class="fas fa-key me-2"></i>
          <span>Analyzing: <a href="{{ link }}" target="_blank" class="text-white">{{ link }}</a></span>
        </div>
        <div class="ms-auto">
          <a href="{{ url_for('keyword_search') }}" class="btn btn-outline-light btn-sm">
            <i class="fas fa-arrow-left me-2"></i>
            Back to Search
          </a>
        </div>
      </div>
    </div>
    
    <div class="card-body">
      <div class="row">
        <!-- Main Content Section - Shows first on mobile and takes more space on desktop -->
        <div class="col-md-8 order-1 order-md-1">
          <div class="stat-card mb-4">
            <!-- Search Form -->
            <div class="search-container mb-4">
              <form method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
                <div class="search-bar">
                  <input type="text" name="keywords" class="search-input" placeholder="Enter keywords separated by commas (max 10)" value="{{ keywords_input }}">
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search me-2"></i>
                    Analyze
                  </button>
                </div>
              </form>
            </div>

            <!-- Keyword Results -->
            {% if keyword_results %}
            <div class="stats-grid mb-4">
              {% for keyword, data in keyword_results.keywords.items() %}
                <div class="stat-card" style="border-left: 4px solid {{ keywords_colors[keyword] if keyword in keywords_colors else '#4f46e5' }}">
                  <div class="stat-value">{{ keyword }}</div>
                  <div class="stat-label">Count: {{ data.count }}</div>
                  <div class="stat-label">Density: {{ data.density | round(2) }}%</div>
                </div>
              {% endfor %}
            </div>
            {% endif %}

            <!-- Extracted Text Section -->
            <div class="mt-4">
              <div class="stat-value">Extracted Text</div>
              <div class="stat-label mb-2">
                Total Words: {{ keyword_results.total_words if keyword_results else extracted_text.split()|length }}
              </div>
              <div class="p-3 bg-background rounded" style="height: 400px; overflow-y: auto;">
                {{ extracted_text.split()|join(' ')|highlight_keywords(keywords_colors)|safe }}
              </div>
            </div>
          </div>
        </div>

        <!-- Related Links Section - Reduced width and shows second on mobile -->
        <div class="col-md-4 order-2 order-md-2">
          <div class="card p-3 h-100">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="stat-value">Related Links</div>
              {% if keyword_results %}
              <a href="{{ url_for('download_keyword_txt', link=link, keywords_input=keywords_input) }}" class="btn btn-primary btn-sm">
                <i class="fas fa-download me-2"></i>
                Download TXT
              </a>
              {% endif %}
            </div>
            
            {% if home_links %}
            <div class="list-group related-links-container" style="height: 600px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; background-color: #f8f9fa;">
              {% for hlink in home_links %}
              <a href="{{ url_for('keyword_detail', link=hlink|safe) }}" class="list-group-item list-group-item-action" style="border-radius: 0; border-left: none; border-right: none; border-top: none;" title="{{ hlink }}">
                {{ hlink }}
              </a>
              {% endfor %}
            </div>
            {% else %}
            <div style="height: 600px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; background-color: #f8f9fa;">
              <div class="related-links-empty">
                <div class="text-center">
                  <i class="fas fa-info-circle mb-2 d-block" style="font-size: 1.5rem;"></i>
                  No related links found
                </div>
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}